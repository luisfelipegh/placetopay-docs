export const sectionMode = 'nav';

export const description = 'This page explores the various 3DSS endpoints you can use to programmatically manage merchants.';

export const apiRefs = ['/api/v1/merchants'];

# Merchants API
---

## Create a Merchant {{ id: 'create-a-merchant', tag: 'POST', label: '/api/v1/merchants' }}

<Row>
  <Col>
      <ApiReader
        path="/api/v1/merchants"
        method="POST"
        api={props.refs}
      />
  </Col>
  <Col sticky>

    <br />
    <CodeGroup title="Request" tag="POST" label="/api/v1/merchants">
    ```bash {{ title: 'cURL' }}
    curl -X "POST" https://3dss-test.placetopay.com/api/v1/merchants \
      -H "Content-Type: application/json" \
      -H "Accept: application/json" \
      -H "Authorization: Bearer ACCESS_TOKEN" \
      -d '{
              "name": "Merchant one",
              "brand": "Brand merchant one",
              "country": "COL",
              "currency": "COP",
              "url": "https://www.merchant.com",
              "mcc": 742,
              "isicClass": 111,
              "enrollment":  true,
              "document": {
                  "type": "NIT",
                  "number": "1234567895"
              },
              "subscriptions": [
                  {
                      "franchise": "visa",
                      "acquirerBIN": "411111",
                      "version": 2,
                      "merchantCode": "1234"
                  },
                  {
                      "franchise": "mastercard",
                      "acquirerBIN": "510510",
                      "version": 2,
                      "merchantCode": "1234"
                  }
              ],
              "branches": [
                  {
                      "name": "Branch one",
                      "brand": "Branch one brand",
                      "country": "COL",
                      "currency": "COP",
                      "url": "https://www.branch1.merchant.com",
                      "enabled": true,
                      "enrollment":  true,
                      "subscriptions": [
                          {
                              "franchise": "visa",
                              "acquirerBIN": "411111",
                              "version": 2,
                              "merchantCode": "1234"
                          },
                          {
                              "franchise": "mastercard",
                              "acquirerBIN": "510510",
                              "version": 2,
                              "merchantCode": "1234"
                          }
                      ]
                  },
                  {
                      "name": "Branch two",
                      "brand": "Branch two brand",
                      "country": "COL",
                      "currency": "COP",
                      "url": "https://www.branch2.merchant.com",
                      "enabled": true,
                      "subscriptions": [
                          {
                              "franchise": "1",
                              "acquirerBIN": "411111",
                              "version": 2,
                              "merchantCode": "1234"
                          }
                      ]
                  }
              ],
              "invitations": []
          }'
    ```
    </CodeGroup>
  </Col>
</Row>

<Row>
  <Col>
    <ApiReader
      path="/api/v1/merchants"
      method="POST"
      type="response"
      api={props.refs}
    />
  </Col>

  <Col sticky>
    <br />
    <CodeGroup title="Response">
    ```json {{ title: '200' }}
    {
      "status": {
        "code":1000
      },
      "data": {
        "merchant": {
          "id":1,
          "name":"Merchant one",
          "token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...",
          "expires_at": "2024-09-16 15:30:45",
          "enrollment": {
              "mastercard": {
                    "uuid": "692b1ce4-7979-4b62-9bab-bda8ad8aa64b",
                    "messageType": "MerchantStatusResponse",
                    "data": {
                        "acquirerBIN": "510510",
                        "acquirerICA": "16233",
                        "acquirerName": "First Technology Federal Credit Union",
                        "acquirerCID": "139423",
                        "status": "SUCCESS",
                        "reason": "New Record Data",
                        "modelId": "123",
                        "modelName": "Test Merchant"
                     },
                    "subscriptionId": 352
                }
            },
        },
        "branches":[
          {
            "id":1,
            "name":"Branch one",
            "token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...",
            "expires_at": "2024-09-16 15:30:45",
            "enrollment": {
                "mastercard": {
                    "uuid": "692b1ce4-7979-4b62-9bab-bda8ad8aa64b",
                    "messageType": "MerchantStatusResponse",
                    "data": {
                        "acquirerBIN": "510510",
                        "acquirerICA": "16233",
                        "acquirerName": "First Technology Federal Credit Union",
                        "acquirerCID": "139423",
                        "status": "SUCCESS",
                        "reason": "New Record Data",
                        "modelId": "123",
                        "modelName": "Test Merchant"
                    },
                    "subscriptionId": 351
                }
             }
          },
          {
             "id":2,
             "name":"Branch two",
             "token":"eyJ0eXAiOiJKV19.eyJhdWQiOiIxIiwianRpIjoiMWIyNjgk867nh...............",
             "expires_at": "2024-09-16 15:30:45"
          }
        ]
      }
    }
    ```
    ```json {{ title: '401' }}
    {
      "message": "Unauthenticated."
    }
    ```
    ```json {{ title: '422' }}
    {
      "status": {
        "code": 1003,
        "error": "The name has already been taken."
      }
    }
    ```
    </CodeGroup>
  </Col>
</Row>

## Field Specifications and Rules for Merchant, Branches, Subscriptions, and Invitations

---
| **Field**                                               | **Required** | **Type** | **Length**               | **Additional Rules**                                                                                                                  | **Must Exist In**                           | **Format/Validation**                          |
|---------------------------------------------------------|--------------|----------|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|------------------------------------------------|
| **name**                                                | Yes          | String   | Max. 90 characters       | Unique (MerchantUnique)                                                                                                               |                                             |                                                |
| **brand**                                               | No           | String   | Max. 25 characters       |                                                                                                                                       |                                             |                                                |
| **country**                                             | Yes          | String   | Exactly 3 characters     | Countries table, alpha_3_code column                                                                                                  | countries table, alpha_3_code column         |                                                |
| **currency**                                            | Yes          | String   |                          | Currencies table, alphabetic_code column                                                                                              | currencies table, alphabetic_code column     |                                                |
| **url**                                                 | Yes          | String   | Max. 90 characters       | Valid URL (ValidUrlRule)                                                                                                              |                                             | Valid URL                                      |
| **mcc**                                                 | Yes          | Numeric  |                          | Merchant_category_codes table, code column                                                                                            | merchant_category_codes table, code column   |                                                |
| **isicClass**                                           | No           | Numeric  |                          | Isic_classes table, code document                                                                                                     | isic_classes table, code document            |                                                |
| **type**                                                | No           | String   |                          | Document_types table, name column                                                                                                     | document_types table, name column            |                                                |
| **enrollment**                                          | No           | Boolean  |                          |                                                                                                                                       |                                             |                                                |
| **number**                                              | No           | String   |                          | Dependent on document type                                                                                                            |                                             | Regex pattern dependent on document type       |
| **subscriptions[n].<br/>franchise**                     | Yes          | String   |                          | Franchises table, brand(name) column, Custom validations (FranchiseEnabled, DirectoryServerExists, DirectoryServerEnabled) | franchises table, brand(name) column         |                                                |
| **subscriptions[n].<br/>acquirerBIN**                   | Yes          | Numeric  |                          | Custom validations (AcquirerBinExists, AcquirerEnabled)                                                                               |                                             |                                                |
| **subscriptions[n].<br/>version**                       | Yes          | Numeric  | 1                        | Allowed values: Defined in Protocol                                                                                                   |                                             |                                                |
| **subscriptions[n].<br/>merchantCode**                  | Yes          | String   |                          |                                                                                                                                       |                                             |                                                |
| **branches[n].<br/>name**                               | Yes          | String   | Max. 90 characters       | Unique (BranchUnique)                                                                                                                 |                                             |                                                |
| **branches[n].<br/>brand**                              | Yes          | String   | Max. 25 characters       |                                                                                                                                       |                                             |                                                |
| **branches[n].<br/>country**                            | Yes          | String   | Exactly 3 characters     | Countries table, alpha_3_code column                                                                                                  | countries table, alpha_3_code column         |                                                |
| **branches[n].<br/>currency**                           | Yes          | String   |                          | Currencies table, alphabetic_code column                                                                                              | currencies table, alphabetic_code column     |                                                |
| **branches[n].<br/>enabled**                            | No           | Boolean  |                          |                                                                                                                                       |                                             |                                                |
| **branches[n].<br/>enrollment**                         | No           | Boolean  |                          |                                                                                                                                       |                                             |                                                |
| **branches[n].<br/>subscriptions[n].<br/>franchise**    | Yes          | String   |                          | Franchises table, brand(name) column, Custom validations (FranchiseEnabled, DirectoryServerExists, DirectoryServerEnabled) | franchises table, brand(name) column         |                                                |
| **branches[n].<br/>subscriptions[n].<br/>acquirerBIN**  | Yes          | Numeric  |                          | Custom validations (AcquirerBinExists, AcquirerEnabled)                                                                               |                                             |                                                |
| **branches[n].<br/>subscriptions[n].<br/>merchantCode** | Yes          | String   |                          |                                                                                                                                       |                                             |                                                |
| **branches[n].<br/>subscriptions[n].<br/>version**      | No           | Numeric  | 1                        |                                                                                                                                       |                                             |                                                |
| **invitations[n]**                                      | Yes          | String   | Max. 255 characters      | Valid email                                                                                                                           |                                             | Valid email                                    |

## Description of validations and additional rules

- **MerchantUnique:** The value in the `name` field must be unique in the database.
- **ValidUrlRule:** The `url` field must be a valid URL.
- **FranchiseEnabled:** Custom validation to verify if the franchise is enabled.
- **DirectoryServerExists:** Verification of directory server existence.
- **DirectoryServerEnabled:** Verification that the directory server is enabled.
- **AcquirerBinExists:** Verification of acquirer BIN existence.
- **AcquirerEnabled:** Verification that the acquirer is enabled.
- **Protocol:** Defines the allowed values for the `version` field.
- **BranchUnique:** The value in the `branches[n].name` field must be unique for each branch.
- **Valid email:** The `invitations[n]` field must be a valid email address.
- **Enrollment:** This value should be sent when requesting enrollment of the tokenizable `merchant` or `branch` model with the brand. Currently, this service is only available for Mastercard.

This table covers all fields and their respective rules for each section mentioned. You can adjust it according to your system specifications.
