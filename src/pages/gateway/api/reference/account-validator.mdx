import {ApiReader, CodeGroup, Col, Row} from "../../../../components/mdx";
export const sectionMode = 'nav';
export const apiRefs = ['/gateway/account-validator/session', '/gateway/account-validator/query', '/gateway/account-validator/validate']

## Introducción {{ id: 'introduction' }}

Este servicio permite utilizar [Account Validator](/account-validator) para obtener cuentas tokenizadas, garantizando así un mayor nivel de seguridad en el manejo de información sensible.

- [Crear una Sesión](/account-validator/api/session#create-a-session)
- [Consultar estado de sesión](/account-validator/api/session#check-session-status)
- [Validar Cuenta existente](/account-validator/api/validate-existing-account)

---

## Crear Sesión {{ id: 'create-session', tag: 'POST', label: '/gateway/account-validator/session' }}

Este endpoint te permite crear una sesión de verificación de cuenta.

<Row>
    <Col>
        <ApiReader
            path="/gateway/account-validator/session"
            method="post"
            api={props.refs}
        />
    </Col> <Col sticky>
    <CodeGroup title="Solicitud" tag="POST" label="/api/session">
    ```bash {{ title: 'cURL' }}
    curl -X "POST" https://api-co-dev.placetopay.ws/gateway/account-validator/session \
      -H "Content-Type: application/json" \
      -d '{
          "locale": "es_CO",
          "auth": {
            "login": "aabbccdd1234567890aabbccdd123456",
            "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
            "nonce": "NjE0OWVkODgwYjNhNw==",
            "seed": "2024-04-19T12:06:56-05:00"
          },
          "user": {
            "name": "John",
            "surname": "Doe",
            "email": "john_doe@mail.com"
          },
          "returnUrl": "https://www.placetopay.com",
          "locale": "es_PR"
      }'
    ```
    </CodeGroup>
  </Col>
</Row>

<Row>
  <Col>
    <ApiReader
      path="/gateway/account-validator/session"
      method="post"
      type="response"
      api={props.refs}
    />
  </Col>

  <Col sticky>
    <br />
    <CodeGroup title="Respuesta">
    ```json {{ title: '200' }}
    {
      "status": {
        "status": "OK",
        "reason": "00",
        "message": "string",
        "date": "2021-09-21T09:34:48-05:00"
      },
      "data": {
        "requestId": "9bd89c8d-6097-4d69-8ce9-d9b5ec35d8ea",
        "redirectUrl": "https://account-validator.placetopay.com/verification/redirect/9bd89c8d-6097-4d69-8ce9-d9b5ec35d8ea",
        "expiresAt": "2024-04-19 17:36:57"
      }
    }
    ```
    ```json {{ title: '400' }}
    {
      "status": {
        "status": "FAILED",
        "reason": "BR",
        "message": "El campo user.email es obligatorio.",
        "date": "2024-04-19T20:15:04+00:00"
      },
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---


## Consultar estado de sesión {{ id: 'check-session-status', tag: 'POST', label: '/gateway/account-validator/query' }}

Este endpoint te permitirá consultar el estado de la sesión creada.

 ### Posibles estados

 Nombre | Descripción
 ---------|----------
  APPROVED | La cuenta fue verificada exitosamente.
  REJECTED | La verificación de cuenta fue rechazada.
  FAILED | Ha ocurrido un error en el sistema.
  PENDING | La verificación de cuenta está en proceso.


  ### Razones de estado

  Código | Descripción
  ---------|----------
   ?C | La verificación ha sido cancelada por el usuario.
   05 | La verificación ha sido rechazada por razones generales.
   BR | Los datos de la solicitud han sido incorrectos.
   00 | La verificación ha sido realizada con éxito.
   ?- | La verificación está en proceso de validación.
   38 | Número de intentos agotado.
   HX | Ha ocurrido un error en el servicio.
   X3 | La información suministrada es inválida.
   X5 | Número de seguridad social Inválido.
   XN | Número de cuenta inválido.
   ?* | Pendiente de validación por microdepositos.



<Row>
    <Col>
        <ApiReader
            path="/gateway/account-validator/query"
            method="post"
            api={props.refs}
        />
    </Col> <Col sticky>
    <CodeGroup title="Solicitud" tag="POST" label="/api/query">
    ```bash {{ title: 'cURL' }}
    curl -X "POST" https://api-co-dev.placetopay.ws/gateway/account-validator/query \
      -H "Content-Type: application/json" \
      -d '{
          "locale": "es_CO",
          "auth": {
            "login": "aabbccdd1234567890aabbccdd123456",
            "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
            "nonce": "NjE0OWVkODgwYjNhNw==",
            "seed": "2024-04-19T12:06:56-05:00"
          },
          "requestId": "9bd89c8d-6097-4d69-8ce9-d9b5ec35d8ea"
      }'
    ```
    </CodeGroup>
  </Col>
</Row>

<Row>
  <Col>
    <ApiReader
      path="/gateway/account-validator/query"
      method="post"
      type="response"
      api={props.refs}
    />
  </Col>

  <Col sticky>
    <br />
    <CodeGroup title="Respuesta">
    ```json {{ title: '200' }}
    {
      "status": {
        "status": "OK",
        "reason": "00",
        "message": "string",
        "date": "2021-09-21T09:34:48-05:00"
      },
      "data": {
        "requestId": "9bd89c8d-6097-4d69-8ce9-d9b5ec35d8ea",
        "isAuthenticated": false,
        "token": {
            "token": "faketoken12f233bd8f5d42138d681bf07ea8295429df07a4af287703e30c891",
            "subtoken": "fakesubtoken00005",
            "franchise": "fakeFranchise",
            "franchiseName": "fakeFranchiseName",
            "issuerName": "fakeIssuerName",
            "lastDigits": "1111",
            "validUntil": "2026-07-31"
        }
      }
    }
    ```
    ```json {{ title: '400' }}
    {
      "status": {
        "status": "FAILED",
        "reason": "BR",
        "message": "El campo user.email es obligatorio.",
        "date": "2024-04-19T20:15:04+00:00"
      },
    }
    ```
    </CodeGroup>
  </Col>
</Row>

---

## Validar Cuenta existente {{ id: 'validate-existing-account', tag: 'POST', label: '/gateway/account-validator/validate' }}

 Una vez realizada de manera exitosa la creación inicial de la sesión podrás realizar validaciones a la cuenta las veces que considere necesarias, solo debes tener la información de la cuenta y el código de verificación entregado en el proceso anterior.

    **Validaciones realizadas:**

    Actualmente el resultado de las validaciones se basa en las siguientes reglas:

    1. **Validación de cuenta existente:** Se verifica que la cuenta exista y haya pasado por un proceso de creación de la sesión desde la interfaz gráfica del verificador de cuentas y además el token generado pertenezca al comercio con el cual se está autenticando.
    2. **Validación de cuenta activa:** Se verifica que la cuenta exista y este activa en el proveedor de validación de cuentas, (PLAID, VaulPopular, Cuentas Comerciales, o el MOCK según corresponda).
    3. **Validación de monto disponible:** Se verifica que la cuenta a validar tenga un monto mayor o igual al monto enviado en la solicitud.

### Razones de estado

Código | Descripción
---------|----------
 05 | La verificación ha sido rechazada por razones generales.
 BR | Los datos de la solicitud han sido incorrectos.
 00 | La verificación ha sido realizada con éxito.
 XA | Monto no disponible para esta cuenta.
 HX | Ha ocurrido un error en el servicio.
 X3 | La información suministrada es inválida.
 X5 | Número de seguridad social Inválido.
 XN | Número de cuenta inválido.


 ### Posibles estados

 Nombre | Descripción
 ---------|----------
  APPROVED | La cuenta fue verificada exitosamente.
  REJECTED | La verificación de cuenta fue rechazada.
  FAILED | Ha ocurrido un error en el sistema.

<Row>
  <Col>
    <ApiReader
      path="/gateway/account-validator/validate"
      method="post"
      api={props.refs}
    />
  </Col>

   <Col sticky>
      <CodeGroup title="Solicitud" tag="POST" label="api/verification/validate">
      ```bash {{ title: 'cURL' }}
      curl -X "POST" https://api-co-dev.placetopay.ws/gateway/account-validator/validate \
        -H "Content-Type: application/json" \
        -d '{
              "auth": {
                "login": "aabbccdd1234567890aabbccdd123456",
                "tranKey": "ABC123example456trankey+789abc012def3456ABC=",
                "nonce": "NjE0OWVkODgwYjNhNw==",
                "seed": "2024-04-19T12:06:56-05:00"
              },
              "intrument": {
                "token": {
                    "token": "faketoken12f233bd8f5d42138d681bf07ea8295429df07a4af287703e30c891",
                    "subtoken": "fakesubtoken00005"
                }
              },
              "payment": {
                "amount": {
                  "currency": "USD",
                  "total": 100
                }
              },
              "locale": "es_ES"
        }'
      ```
      </CodeGroup>
    </Col>
</Row>
<Row>
  <Col>
    <ApiReader
      path="/gateway/account-validator/validate"
      method="post"
      type="response"
      api={props.refs}
    />
  </Col>

  <Col sticky>
    <br />
    <CodeGroup title="Respuesta">
    ```json {{ title: '200' }}
    {
        "status": "APPROVED",
        "reason": "00",
        "message": "La verificación ha sido exítosa",
        "date": "2024-04-19T20:51:52+00:00"
    }
    ```
    ```json {{ title: '400' }}
    {
      "status": {
        "status": "FAILED",
        "reason": "BR",
        "message": "El payment.amount.currency seleccionado no es válido.",
        "date": "2024-04-19T21:33:00+00:00"
      }
    }
    ```
    </CodeGroup>
  </Col>
</Row>
